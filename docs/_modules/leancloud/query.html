<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>leancloud.query &mdash; LeanCloud-Python-SDK 2.6.1 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> LeanCloud-Python-SDK
          </a>
              <div class="version">
                2.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">LeanCloud-Python-SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">模块代码</a> &raquo;</li>
      <li>leancloud.query</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>leancloud.query 源代码</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf-8</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">import</span> <span class="nn">leancloud</span>
<span class="kn">from</span> <span class="nn">leancloud</span> <span class="kn">import</span> <span class="n">client</span>
<span class="kn">from</span> <span class="nn">leancloud</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">leancloud.file_</span> <span class="kn">import</span> <span class="n">File</span>
<span class="kn">from</span> <span class="nn">leancloud.object_</span> <span class="kn">import</span> <span class="n">Object</span>
<span class="kn">from</span> <span class="nn">leancloud.errors</span> <span class="kn">import</span> <span class="n">LeanCloudError</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;asaka &lt;lan@leancloud.rocks&gt;&quot;</span>


<span class="k">class</span> <span class="nc">CQLResult</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CQL 查询结果对象。</span>

<span class="sd">    Attributes:</span>
<span class="sd">        results: 返回的查询结果</span>

<span class="sd">        count: 如果查询语句包含 count，将保存在此字段</span>

<span class="sd">        class_name: 查询的 class 名称</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;class_name&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">class_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span>


<span class="k">class</span> <span class="nc">Cursor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query.scan 返回结果对象。</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_class</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">scan_key</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_class</span> <span class="o">=</span> <span class="n">query_class</span>

        <span class="k">if</span> <span class="n">batch_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">batch_size</span>

        <span class="k">if</span> <span class="n">scan_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;scan_key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_key</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;/scan/classes/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>
            <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_class</span><span class="p">()</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">_update_data</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">obj</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cursor&quot;</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;cursor&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="Query"><a class="viewcode-back" href="../../index.html#leancloud.Query">[文档]</a><span class="k">class</span> <span class="nc">Query</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_class</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param query_class: 要查询的 class 名称或者对象</span>
<span class="sd">        :type query_class: string_types or leancloud.ObjectMeta</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query_class</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">query_class</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;_File&quot;</span><span class="p">):</span>
                <span class="n">query_class</span> <span class="o">=</span> <span class="n">File</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query_class</span> <span class="o">=</span> <span class="n">Object</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">query_class</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query_class</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">class_types</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span>
            <span class="n">query_class</span><span class="p">,</span> <span class="p">(</span><span class="n">File</span><span class="p">,</span> <span class="n">Object</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Query takes string or LeanCloud Object&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_query_class</span> <span class="o">=</span> <span class="n">query_class</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_where</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_include</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_include_acl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skip</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_select</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Query.or_"><a class="viewcode-back" href="../../index.html#leancloud.Query.or_">[文档]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">or_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">queries</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        根据传入的 Query 对象，构造一个新的 OR 查询。</span>

<span class="sd">        :param queries: 需要构造的子查询列表</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;or_ need two queries at least&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">x</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span> <span class="o">==</span> <span class="n">queries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">queries</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All queries must be for the same class&quot;</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">queries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">_or_query</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">query</span></div>

<div class="viewcode-block" id="Query.and_"><a class="viewcode-back" href="../../index.html#leancloud.Query.and_">[文档]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">and_</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">queries</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        根据传入的 Query 对象，构造一个新的 AND 查询。</span>

<span class="sd">        :param queries: 需要构造的子查询列表</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;and_ need two queries at least&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">x</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span> <span class="o">==</span> <span class="n">queries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">queries</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All queries must be for the same class&quot;</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">queries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">_and_query</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">query</span></div>

<div class="viewcode-block" id="Query.do_cloud_query"><a class="viewcode-back" href="../../index.html#leancloud.Query.do_cloud_query">[文档]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">do_cloud_query</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cql</span><span class="p">,</span> <span class="o">*</span><span class="n">pvalues</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        使用 CQL 来构造查询。CQL 语法参考 `这里 &lt;https://cn.avoscloud.com/docs/cql_guide.html&gt;`_。</span>

<span class="sd">        :param cql: CQL 语句</span>
<span class="sd">        :param pvalues: 查询参数</span>
<span class="sd">        :rtype: CQLResult</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cql&quot;</span><span class="p">:</span> <span class="n">cql</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pvalues</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">pvalues</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pvalues</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;pvalues&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pvalues</span><span class="p">)</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/cloudQuery&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s2">&quot;className&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">_new_object</span><span class="p">()</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_update_data</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">_process_result</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CQLResult</span><span class="p">(</span><span class="n">objs</span><span class="p">,</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">),</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;className&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Query.dump"><a class="viewcode-back" href="../../index.html#leancloud.Query.dump">[文档]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: 当前对象的序列化结果</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_where</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_include</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;include&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_include</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;keys&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_select</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_include_acl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;returnACL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_include_acl</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">)</span>
        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extra</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span></div>

    <span class="k">def</span> <span class="nf">_new_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_class</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_process_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">_do_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;/classes/</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span><span class="p">),</span> <span class="n">params</span>
        <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<div class="viewcode-block" id="Query.first"><a class="viewcode-back" href="../../index.html#leancloud.Query.first">[文档]</a>    <span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        根据查询获取最多一个对象。</span>

<span class="sd">        :return: 查询结果</span>
<span class="sd">        :rtype: Object</span>
<span class="sd">        :raise: LeanCloudError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LeanCloudError</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="s2">&quot;Object not found&quot;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_object</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_update_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_result</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="Query.get"><a class="viewcode-back" href="../../index.html#leancloud.Query.get">[文档]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        根据 objectId 查询。</span>

<span class="sd">        :param object_id: 要查询对象的 objectId</span>
<span class="sd">        :return: 查询结果</span>
<span class="sd">        :rtype: Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">object_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LeanCloudError</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s2">&quot;Object not found.&quot;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">create_without_data</span><span class="p">(</span><span class="n">object_id</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_select</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_include</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="Query.find"><a class="viewcode-back" href="../../index.html#leancloud.Query.find">[文档]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        根据查询条件，获取包含所有满足条件的对象。</span>

<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">())</span>

        <span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_object</span><span class="p">()</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_update_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_result</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">objs</span></div>

<div class="viewcode-block" id="Query.scan"><a class="viewcode-back" href="../../index.html#leancloud.Query.scan">[文档]</a>    <span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scan_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;skip&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LeanCloudError</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Query.scan dose not support skip option&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;limit&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LeanCloudError</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Query.scan dose not support limit option&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Cursor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_class</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">scan_key</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Query.count"><a class="viewcode-back" href="../../index.html#leancloud.Query.count">[文档]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        返回满足查询条件的对象的数量。</span>

<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Query.skip"><a class="viewcode-back" href="../../index.html#leancloud.Query.skip">[文档]</a>    <span class="k">def</span> <span class="nf">skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        查询条件中跳过指定个数的对象，在做分页时很有帮助。</span>

<span class="sd">        :param n: 需要跳过对象的个数</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skip</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.limit"><a class="viewcode-back" href="../../index.html#leancloud.Query.limit">[文档]</a>    <span class="k">def</span> <span class="nf">limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        设置查询返回结果的数量。如果不设置，默认为 100。最大返回数量为 1000，如果超过这个数量，需要使用多次查询来获取结果。</span>

<span class="sd">        :param n: 限制结果的数量</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;limit only accept number less than or equal to 1000&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_limit</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.include_acl"><a class="viewcode-back" href="../../index.html#leancloud.Query.include_acl">[文档]</a>    <span class="k">def</span> <span class="nf">include_acl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        设置查询结果的对象，是否包含 ACL 字段。需要在控制台选项中开启对应选项才能生效。</span>

<span class="sd">        :param value: 是否包含 ACL，默认为 True</span>
<span class="sd">        :type value: bool</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_include_acl</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.equal_to"><a class="viewcode-back" href="../../index.html#leancloud.Query.equal_to">[文档]</a>    <span class="k">def</span> <span class="nf">equal_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，查询字段的值必须为指定值。</span>

<span class="sd">        :param key: 查询条件的字段名</span>
<span class="sd">        :param value: 查询条件的值</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_where</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.size_equal_to"><a class="viewcode-back" href="../../index.html#leancloud.Query.size_equal_to">[文档]</a>    <span class="k">def</span> <span class="nf">size_equal_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果指定数组字段长度与查询值相同</span>

<span class="sd">        :param key: 查询条件数组字段名</span>
<span class="sd">        :param size: 查询条件值</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$size&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_add_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_where</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_where</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_where</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Query.not_equal_to"><a class="viewcode-back" href="../../index.html#leancloud.Query.not_equal_to">[文档]</a>    <span class="k">def</span> <span class="nf">not_equal_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果指定字段的值与查询值不同</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param value: 查询条件值</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$ne&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.less_than"><a class="viewcode-back" href="../../index.html#leancloud.Query.less_than">[文档]</a>    <span class="k">def</span> <span class="nf">less_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果指定字段的值小于查询值</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param value: 查询条件值</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$lt&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.greater_than"><a class="viewcode-back" href="../../index.html#leancloud.Query.greater_than">[文档]</a>    <span class="k">def</span> <span class="nf">greater_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果指定字段的值大于查询值</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param value: 查询条件值</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$gt&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.less_than_or_equal_to"><a class="viewcode-back" href="../../index.html#leancloud.Query.less_than_or_equal_to">[文档]</a>    <span class="k">def</span> <span class="nf">less_than_or_equal_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果指定字段的值小于等于查询值</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param value: 查询条件值</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$lte&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.greater_than_or_equal_to"><a class="viewcode-back" href="../../index.html#leancloud.Query.greater_than_or_equal_to">[文档]</a>    <span class="k">def</span> <span class="nf">greater_than_or_equal_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果指定字段的值大于等于查询值</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param value: 查询条件值名</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$gte&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.contained_in"><a class="viewcode-back" href="../../index.html#leancloud.Query.contained_in">[文档]</a>    <span class="k">def</span> <span class="nf">contained_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果指定字段的值在查询值列表中</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param values: 查询条件值</span>
<span class="sd">        :type values: list or tuple</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$in&quot;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.not_contained_in"><a class="viewcode-back" href="../../index.html#leancloud.Query.not_contained_in">[文档]</a>    <span class="k">def</span> <span class="nf">not_contained_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果指定字段的值不在查询值列表中</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param values: 查询条件值</span>
<span class="sd">        :type values: list or tuple</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$nin&quot;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.contains_all"><a class="viewcode-back" href="../../index.html#leancloud.Query.contains_all">[文档]</a>    <span class="k">def</span> <span class="nf">contains_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果指定字段的值全部包含与查询值列表中</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param values: 查询条件值</span>
<span class="sd">        :type values: list or tuple</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$all&quot;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.exists"><a class="viewcode-back" href="../../index.html#leancloud.Query.exists">[文档]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果对象包含指定字段</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$exists&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.does_not_exist"><a class="viewcode-back" href="../../index.html#leancloud.Query.does_not_exist">[文档]</a>    <span class="k">def</span> <span class="nf">does_not_exist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果对象不包含指定字段</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$exists&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.matched"><a class="viewcode-back" href="../../index.html#leancloud.Query.matched">[文档]</a>    <span class="k">def</span> <span class="nf">matched</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">ignore_case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">multi_line</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果对象指定字段满足指定的正则表达式。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param regex: 查询正则表达式</span>
<span class="sd">        :param ignore_case: 查询是否忽略大小写，默认不忽略</span>
<span class="sd">        :param multi_line: 查询是否匹配多行，默认不匹配</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;matched only accept str or unicode&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$regex&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>
        <span class="n">modifiers</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ignore_case</span><span class="p">:</span>
            <span class="n">modifiers</span> <span class="o">+=</span> <span class="s2">&quot;i&quot;</span>
        <span class="k">if</span> <span class="n">multi_line</span><span class="p">:</span>
            <span class="n">modifiers</span> <span class="o">+=</span> <span class="s2">&quot;m&quot;</span>
        <span class="k">if</span> <span class="n">modifiers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$options&quot;</span><span class="p">,</span> <span class="n">modifiers</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.matches_query"><a class="viewcode-back" href="../../index.html#leancloud.Query.matches_query">[文档]</a>    <span class="k">def</span> <span class="nf">matches_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果对象指定字段的值，与另外一个查询对象的返回结果相同。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param query: 查询对象</span>
<span class="sd">        :type query: Query</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
        <span class="n">dumped</span><span class="p">[</span><span class="s2">&quot;className&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$inQuery&quot;</span><span class="p">,</span> <span class="n">dumped</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.does_not_match_query"><a class="viewcode-back" href="../../index.html#leancloud.Query.does_not_match_query">[文档]</a>    <span class="k">def</span> <span class="nf">does_not_match_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果对象指定字段的值，与另外一个查询对象的返回结果不相同。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param query: 查询对象</span>
<span class="sd">        :type query: Query</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
        <span class="n">dumped</span><span class="p">[</span><span class="s2">&quot;className&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$notInQuery&quot;</span><span class="p">,</span> <span class="n">dumped</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.matches_key_in_query"><a class="viewcode-back" href="../../index.html#leancloud.Query.matches_key_in_query">[文档]</a>    <span class="k">def</span> <span class="nf">matches_key_in_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">query_key</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果对象指定字段的值，与另外一个查询对象的返回结果指定的值相同。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param query_key: 查询对象返回结果的字段名</span>
<span class="sd">        :param query: 查询对象</span>
<span class="sd">        :type query: Query</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
        <span class="n">dumped</span><span class="p">[</span><span class="s2">&quot;className&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$select&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">query_key</span><span class="p">,</span> <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">dumped</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.does_not_match_key_in_query"><a class="viewcode-back" href="../../index.html#leancloud.Query.does_not_match_key_in_query">[文档]</a>    <span class="k">def</span> <span class="nf">does_not_match_key_in_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">query_key</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果对象指定字段的值，与另外一个查询对象的返回结果指定的值不相同。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param query_key: 查询对象返回结果的字段名</span>
<span class="sd">        :param query: 查询对象</span>
<span class="sd">        :type query: Query</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
        <span class="n">dumped</span><span class="p">[</span><span class="s2">&quot;className&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">_query_class</span><span class="o">.</span><span class="n">_class_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$dontSelect&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">query_key</span><span class="p">,</span> <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">dumped</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_or_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queries</span><span class="p">):</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">dump</span><span class="p">()[</span><span class="s2">&quot;where&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_where</span><span class="p">[</span><span class="s2">&quot;$or&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dumped</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_and_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queries</span><span class="p">):</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">dump</span><span class="p">()[</span><span class="s2">&quot;where&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_where</span><span class="p">[</span><span class="s2">&quot;$and&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dumped</span>

    <span class="k">def</span> <span class="nf">_quote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># return &quot;\\Q&quot; + s.replace(&quot;\\E&quot;, &quot;\\E\\\\E\\Q&quot;) + &quot;\\E&quot;</span>
        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="Query.contains"><a class="viewcode-back" href="../../index.html#leancloud.Query.contains">[文档]</a>    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果对象指定最短的值，包含指定字符串。在数据量比较大的情况下会比较慢。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param value: 需要包含的字符串</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$regex&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quote</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.startswith"><a class="viewcode-back" href="../../index.html#leancloud.Query.startswith">[文档]</a>    <span class="k">def</span> <span class="nf">startswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果对象指定最短的值，以指定字符串开头。在数据量比较大的情况下会比较慢。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param value: 需要查询的字符串</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$regex&quot;</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quote</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.endswith"><a class="viewcode-back" href="../../index.html#leancloud.Query.endswith">[文档]</a>    <span class="k">def</span> <span class="nf">endswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制查询结果对象指定最短的值，以指定字符串结尾。在数据量比较大的情况下会比较慢。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param value: 需要查询的字符串</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$regex&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quote</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;$&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.ascending"><a class="viewcode-back" href="../../index.html#leancloud.Query.ascending">[文档]</a>    <span class="k">def</span> <span class="nf">ascending</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        限制查询返回结果以指定字段升序排序。</span>

<span class="sd">        :param key: 排序字段名</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.add_ascending"><a class="viewcode-back" href="../../index.html#leancloud.Query.add_ascending">[文档]</a>    <span class="k">def</span> <span class="nf">add_ascending</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询排序条件。之前指定的排序条件优先级更高。</span>

<span class="sd">        :param key: 排序字段名</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.descending"><a class="viewcode-back" href="../../index.html#leancloud.Query.descending">[文档]</a>    <span class="k">def</span> <span class="nf">descending</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        限制查询返回结果以指定字段降序排序。</span>

<span class="sd">        :param key: 排序字段名</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.add_descending"><a class="viewcode-back" href="../../index.html#leancloud.Query.add_descending">[文档]</a>    <span class="k">def</span> <span class="nf">add_descending</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询排序条件。之前指定的排序条件优先级更高。</span>

<span class="sd">        :param key: 排序字段名</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.near"><a class="viewcode-back" href="../../index.html#leancloud.Query.near">[文档]</a>    <span class="k">def</span> <span class="nf">near</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制返回结果指定字段值的位置与给定地理位置临近。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param point: 需要查询的地理位置</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;near query does not accept None&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$nearSphere&quot;</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.within_radians"><a class="viewcode-back" href="../../index.html#leancloud.Query.within_radians">[文档]</a>    <span class="k">def</span> <span class="nf">within_radians</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">max_distance</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制返回结果指定字段值的位置在某点的一段距离之内。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param point: 查询地理位置</span>
<span class="sd">        :param max_distance: 最大距离限定（弧度）</span>
<span class="sd">        :param min_distance: 最小距离限定（弧度）</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">near</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$maxDistance&quot;</span><span class="p">,</span> <span class="n">max_distance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$minDistance&quot;</span><span class="p">,</span> <span class="n">min_distance</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.within_miles"><a class="viewcode-back" href="../../index.html#leancloud.Query.within_miles">[文档]</a>    <span class="k">def</span> <span class="nf">within_miles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">max_distance</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制返回结果指定字段值的位置在某点的一段距离之内。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param point: 查询地理位置</span>
<span class="sd">        :param max_distance: 最大距离限定（英里）</span>
<span class="sd">        :param min_distance: 最小距离限定（英里）</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">min_distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">min_distance</span> <span class="o">=</span> <span class="n">min_distance</span> <span class="o">/</span> <span class="mf">3958.8</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">within_radians</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">max_distance</span> <span class="o">/</span> <span class="mf">3958.8</span><span class="p">,</span> <span class="n">min_distance</span><span class="p">)</span></div>

<div class="viewcode-block" id="Query.within_kilometers"><a class="viewcode-back" href="../../index.html#leancloud.Query.within_kilometers">[文档]</a>    <span class="k">def</span> <span class="nf">within_kilometers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">max_distance</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制返回结果指定字段值的位置在某点的一段距离之内。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param point: 查询地理位置</span>
<span class="sd">        :param max_distance: 最大距离限定（千米）</span>
<span class="sd">        :param min_distance: 最小距离限定（千米）</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">min_distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">min_distance</span> <span class="o">=</span> <span class="n">min_distance</span> <span class="o">/</span> <span class="mf">6371.0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">within_radians</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">max_distance</span> <span class="o">/</span> <span class="mf">6371.0</span><span class="p">,</span> <span class="n">min_distance</span><span class="p">)</span></div>

<div class="viewcode-block" id="Query.within_geo_box"><a class="viewcode-back" href="../../index.html#leancloud.Query.within_geo_box">[文档]</a>    <span class="k">def</span> <span class="nf">within_geo_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">southwest</span><span class="p">,</span> <span class="n">northeast</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        增加查询条件，限制返回结果指定字段值的位置在指定坐标范围之内。</span>

<span class="sd">        :param key: 查询条件字段名</span>
<span class="sd">        :param southwest: 限制范围西南角坐标</span>
<span class="sd">        :param northeast: 限制范围东北角坐标</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_condition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;$within&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;$box&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">southwest</span><span class="p">,</span> <span class="n">northeast</span><span class="p">]})</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.include"><a class="viewcode-back" href="../../index.html#leancloud.Query.include">[文档]</a>    <span class="k">def</span> <span class="nf">include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        指定查询返回结果中包含关联表字段。</span>

<span class="sd">        :param keys: 关联子表字段名</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_include</span> <span class="o">+=</span> <span class="n">keys</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Query.select"><a class="viewcode-back" href="../../index.html#leancloud.Query.select">[文档]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        指定查询返回结果中只包含某些字段。可以重复调用，每次调用的包含内容都将会被返回。</span>

<span class="sd">        :param keys: 包含字段名</span>
<span class="sd">        :rtype: Query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_select</span> <span class="o">+=</span> <span class="n">keys</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="FriendshipQuery"><a class="viewcode-back" href="../../index.html#leancloud.FriendshipQuery">[文档]</a><span class="k">class</span> <span class="nc">FriendshipQuery</span><span class="p">(</span><span class="n">Query</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_class</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FriendshipQuery</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">query_class</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query_class</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;_Follower&quot;</span><span class="p">,</span> <span class="s2">&quot;Follower&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_friendship_tag</span> <span class="o">=</span> <span class="s2">&quot;follower&quot;</span>
        <span class="k">elif</span> <span class="n">query_class</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;_Followee&quot;</span><span class="p">,</span> <span class="s2">&quot;Followee&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_friendship_tag</span> <span class="o">=</span> <span class="s2">&quot;followee&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;FriendshipQuery takes only follower or followee&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_new_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_process_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_friendship_tag</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;__type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pointer&quot;</span> <span class="ow">and</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;className&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_User&quot;</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;__type&quot;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;className&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">content</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2015, asaka.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>